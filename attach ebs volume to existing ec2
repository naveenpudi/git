---
- name: Attach new EBS volume to a running EC2 instance
  hosts: localhost
  connection: local
  gather_facts: false

  vars:
    aws_access_key: AKIAXKNVCS7C5ZZSN2OP
    aws_secret_key: 96Ci8Dle+5D0gwGgZfy/UILHL2WjNp0oI1+Bk+fq
    region: us-east-2
    instance_id: i-023e998620cd38f39     # Replace with your running instance ID
    availability_zone: us-east-2a        # Replace with actual AZ of the instance
    volume_size: 8
    volume_type: gp2
    device_name: /dev/xvdf

  tasks:

    - name: Create a new EBS volume
      amazon.aws.ec2_vol:
        aws_access_key: "{{ aws_access_key }}"
        aws_secret_key: "{{ aws_secret_key }}"
        region: "{{ region }}"
        zone: "{{ availability_zone }}"
        volume_size: "{{ volume_size }}"
        volume_type: "{{ volume_type }}"
        state: present
        tags:
          Name: Additional-EBS
      register: new_ebs

    - name: Attach the new EBS volume to the running EC2 instance
      amazon.aws.ec2_vol:
        aws_access_key: "{{ aws_access_key }}"
        aws_secret_key: "{{ aws_secret_key }}"
        region: "{{ region }}"
        instance: "{{ instance_id }}"
        id: "{{ new_ebs.volume_id }}"
        device_name: "{{ device_name }}"
        state: present
